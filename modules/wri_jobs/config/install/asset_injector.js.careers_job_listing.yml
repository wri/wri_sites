uuid: 00e99a14-4949-4b40-97fa-1c20aae39bee
langcode: en
status: true
dependencies:
  module:
    - node
id: careers_job_listing
label: 'Careers job listing'
code: |
  (function ($, Drupal) {
    Drupal.behaviors.deadlineCheck = {
      attach: function (context, settings) {
        // 1. Target the field label that precedes the correct date.
        const $labelElement = $('.field-label-inline:contains("Application Deadline")', context).first();

        if ($labelElement.length === 0) {
          // Console logging removed here to keep console clean for other outputs.
          return;
        }

        // 2. Target the <time> element that is *immediately after* the correct label.
        const $deadlineElement = $labelElement.next('time.datetime'); 
        
        if ($deadlineElement.length === 0) {
          // Console logging removed here.
          return;
        }
        
        const $applyLink = $('.apply-link', context).first();
        const deadlineISO = $deadlineElement.attr('datetime');

        if (deadlineISO) {
          // Create Date objects for comparison.
          const deadlineDate = new Date(deadlineISO);
          const currentDate = new Date();
          
          // --- START ENHANCED DEBUGGING OUTPUT ---
          console.log("--- DEADLINE DEBUG START ---");
          
          // List all datetime attributes found on the page for comparison
          console.log("ALL DATETIME ELEMENTS FOUND:");
          $('time.datetime', context).each(function(index) {
            console.log(`Index ${index}:`, $(this).attr('datetime'));
          });
          
          console.log("\nDATE SELECTED FOR CHECK:");
          console.log(`Element Selector Used: .field-label-inline:contains("Application Deadline") + time.datetime`);
          console.log("ISO Value Being Used: ", deadlineISO);
          
          // Print comparison results
          console.log("\nDATE COMPARISON:");
          console.log("Current Date (Client Time): ", currentDate.toISOString());
          console.log("Deadline Date (Parsed): ", deadlineDate.toISOString());
          
          const comparisonResult = (currentDate.getTime() > deadlineDate.getTime()) ? "PASSED" : "PENDING";
          console.log(`Result of Comparison (Current > Deadline): ${comparisonResult}`);
          
          console.log("--- DEADLINE DEBUG END ---");
          // --- END ENHANCED DEBUGGING OUTPUT ---

          // 3. Conditional Logic
          if (currentDate.getTime() > deadlineDate.getTime()) {
            // Deadline has passed - run the replacement
            if ($applyLink.length > 0) {
               $applyLink.replaceWith('<h3>The application deadline for this job posting has passed.</h3>');
            }
          }
        } 
      }
    };
  })(jQuery, Drupal);
noscript: ''
noscriptRegion: {  }
jquery: false
header: false
preprocess: false
conditions:
  'entity_bundle:node':
    id: 'entity_bundle:node'
    negate: false
    context_mapping:
      node: '@node.node_route_context:node'
    bundles:
      jobs: jobs
contexts: {  }
conditions_require_all: true
